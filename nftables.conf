#!/usr/sbin/nft -f

flush ruleset

table inet filter {
	chain input {
		type filter hook input priority 0;
		policy drop;
		iif lo accept
		ct state established,related accept
		ct state invalid drop
		# Allow DHCP requests and responses
		udp sport 67 udp dport 68 accept
		# Limit the rate of new connection attempts to any port
		ct state new limit rate over 30/second burst 50 packets drop
		udp dport { 3478, 3479, 19302-19309, 10000-20000 } accept
		tcp dport 443 ct state new accept
		log prefix "nftables-dropped: " level info limit rate 5/minute
	}
	chain forward {
		type filter hook forward priority 0;
		policy drop;
	}
	chain output {
		type filter hook output priority 0;
		policy accept;
	}
}
